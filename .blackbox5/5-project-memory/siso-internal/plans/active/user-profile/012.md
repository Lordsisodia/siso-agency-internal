---
name: Build PrivacySettings Component
status: open
created: 2026-01-18T08:24:04Z
parallel: true
effort: 3 hours
depends_on: [008]
conflicts_with: []
---

# Task: 012 - Build PrivacySettings Component

## Specification
Create the PrivacySettings component with visibility toggles and data export functionality. This component allows users to control their privacy settings and export their data.

## Acceptance Criteria
- [ ] `PrivacySettings` component created
- [ ] `VisibilityToggles` component for visibility controls
- [ ] `DataExportButton` component for data export
- [ ] Profile visibility toggle
- [ ] Email visibility toggle
- [ ] Bio visibility toggle
- [ ] Location visibility toggle
- [ ] Social links visibility toggle
- [ ] Data export functionality (JSON)
- [ ] Export includes timestamp

## Files
- `src/domains/user/profile/4-privacy/ui/components/VisibilityToggles.tsx` (new)
- `src/domains/user/profile/4-privacy/ui/components/DataExportButton.tsx` (new)
- `src/domains/user/profile/4-privacy/ui/components/PrivacySettings.tsx` (new)
- `src/domains/user/profile/4-privacy/ui/pages/PrivacySettingsPage.tsx` (new)
- `src/domains/user/profile/4-privacy/index.ts` (new)

## Technical Approach

### Step 1: Create VisibilityToggles Component
```typescript
// src/domains/user/profile/4-privacy/ui/components/VisibilityToggles.tsx
import { useFormContext } from 'react-hook-form'
import { Switch } from '@/components/ui/switch'
import { Label } from '@/components/ui/label'
import { FormField, FormItem, FormControl, FormDescription } from '@/components/ui/form'
import { Card } from '@/components/ui/card'

interface ToggleField {
  name: keyof PrivacySettings
  label: string
  description: string
  defaultWarning?: string
}

const TOGGLE_FIELDS: ToggleField[] = [
  {
    name: 'profile_visible',
    label: 'Public Profile',
    description: 'Allow anyone to view your profile',
    defaultWarning: 'Your profile will be private by default'
  },
  {
    name: 'email_visible',
    label: 'Email Address',
    description: 'Show your email on your profile'
  },
  {
    name: 'bio_visible',
    label: 'Bio',
    description: 'Show your bio on your profile'
  },
  {
    name: 'location_visible',
    label: 'Location',
    description: 'Show your location on your profile'
  },
  {
    name: 'social_links_visible',
    label: 'Social Links',
    description: 'Show your social media links'
  }
]

export function VisibilityToggles() {
  const { control } = useFormContext()

  return (
    <Card className="p-6">
      <h2 className="text-lg font-semibold mb-4">Profile Visibility</h2>
      <p className="text-sm text-muted-foreground mb-6">
        Control what information is visible on your profile
      </p>

      <div className="space-y-6">
        {TOGGLE_FIELDS.map((field) => (
          <FormField
            key={field.name}
            control={control}
            name={field.name}
            render={({ field: formField }) => (
              <FormItem className="flex flex-row items-center justify-between">
                <div className="flex-1">
                  <Label htmlFor={field.name}>{field.label}</Label>
                  <FormDescription>{field.description}</FormDescription>
                </div>
                <FormControl>
                  <Switch
                    id={field.name}
                    checked={formField.value}
                    onCheckedChange={formField.onChange}
                  />
                </FormControl>
              </FormItem>
            )}
          />
        ))}
      </div>

      <div className="mt-6 p-4 bg-muted rounded-lg">
        <p className="text-sm font-medium">Privacy First</p>
        <p className="text-xs text-muted-foreground mt-1">
          Your profile is set to private by default. Only enable the features you want to share.
        </p>
      </div>
    </Card>
  )
}
```

### Step 2: Create DataExportButton Component
```typescript
// src/domains/user/profile/4-privacy/ui/components/DataExportButton.tsx
import { Download, Loader2 } from 'lucide-react'
import { Button } from '@/components/ui/button'
import { Alert, AlertDescription } from '@/components/ui/alert'
import { Info } from 'lucide-react'
import { useExportUserData } from '../../_shared/hooks'
import { useState } from 'react'

interface DataExportButtonProps {
  userId: string
}

export function DataExportButton({ userId }: DataExportButtonProps) {
  const exportData = useExportUserData()
  const [exported, setExported] = useState(false)

  const handleExport = async () => {
    try {
      await exportData.mutateAsync(userId)
      setExported(true)
      setTimeout(() => setExported(false), 3000)
    } catch (error) {
      console.error('Export failed:', error)
    }
  }

  return (
    <div className="space-y-4">
      <Alert>
        <Info className="h-4 w-4" />
        <AlertDescription>
          Download all your profile data in JSON format. This includes your profile information,
          privacy settings, and social links.
        </AlertDescription>
      </Alert>

      <Button
        onClick={handleExport}
        disabled={exportData.isPending}
        variant="outline"
        className="w-full"
      >
        {exportData.isPending ? (
          <>
            <Loader2 className="w-4 h-4 mr-2 animate-spin" />
            Preparing Export...
          </>
        ) : exported ? (
          <>
            <Download className="w-4 h-4 mr-2" />
            Export Downloaded!
          </>
        ) : (
          <>
            <Download className="w-4 h-4 mr-2" />
            Export My Data
          </>
        )}
      </Button>

      <p className="text-xs text-muted-foreground">
        Your right to data portability (GDPR/CCPA)
      </p>
    </div>
  )
}
```

### Step 3: Create Main PrivacySettings Component
```typescript
// src/domains/user/profile/4-privacy/ui/components/PrivacySettings.tsx
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { privacySettingsSchema } from '../../_shared/types'
import type { PrivacySettings } from '../../_shared/types'
import { usePrivacySettings, useUpdatePrivacySettings } from '../../_shared/hooks'
import { VisibilityToggles } from './VisibilityToggles'
import { DataExportButton } from './DataExportButton'
import { Card } from '@/components/ui/card'
import { Loader2 } from 'lucide-react'

interface PrivacySettingsProps {
  userId: string
}

export function PrivacySettings({ userId }: PrivacySettingsProps) {
  const { data: settings, isLoading } = usePrivacySettings(userId)
  const updateSettings = useUpdatePrivacySettings()

  const form = useForm<PrivacySettings>({
    resolver: zodResolver(privacySettingsSchema),
    defaultValues: {
      profile_visible: false,
      email_visible: false,
      bio_visible: false,
      location_visible: false,
      social_links_visible: false
    }
  })

  // Update form when settings load
  if (settings && !form.formState.isDirty) {
    form.reset(settings)
  }

  const handleChange = async (field: keyof PrivacySettings, value: boolean) => {
    try {
      await updateSettings.mutateAsync({
        userId,
        settings: { [field]: value }
      })
    } catch (error) {
      console.error('Failed to update privacy settings:', error)
      // Revert on error
      form.setValue(field, !value)
    }
  }

  // Watch all values and update on change
  form.watch((value, { name, type }) => {
    if (type === 'change' && name) {
      const fieldName = name as keyof PrivacySettings
      const currentValue = settings?.[fieldName]
      const newValue = value[fieldName]

      if (currentValue !== newValue) {
        handleChange(fieldName, newValue as boolean)
      }
    }
  })

  if (isLoading) {
    return (
      <div className="flex items-center justify-center py-12">
        <Loader2 className="w-8 h-8 animate-spin text-muted-foreground" />
      </div>
    )
  }

  return (
    <div className="space-y-6">
      <form>
        <VisibilityToggles />
      </form>

      <Card className="p-6">
        <h2 className="text-lg font-semibold mb-4">Data Export</h2>
        <DataExportButton userId={userId} />
      </Card>
    </div>
  )
}
```

### Step 4: Create Page Component
```typescript
// src/domains/user/profile/4-privacy/ui/pages/PrivacySettingsPage.tsx
import { useNavigate } from 'react-router-dom'
import { Button } from '@/components/ui/button'
import { ArrowLeft } from 'lucide-react'
import { useAuth } from '@/features/auth'
import { PrivacySettings } from '../components/PrivacySettings'

export function PrivacySettingsPage() {
  const navigate = useNavigate()
  const { data: { user } } = useAuth()

  return (
    <div className="container max-w-2xl py-8">
      <Button
        variant="ghost"
        onClick={() => navigate('/profile')}
        className="mb-4"
      >
        <ArrowLeft className="w-4 h-4 mr-2" />
        Back to Profile
      </Button>

      <h1 className="text-3xl font-bold mb-2">Privacy Settings</h1>
      <p className="text-muted-foreground mb-6">
        Control your privacy and manage your data
      </p>

      {user ? (
        <PrivacySettings userId={user.id} />
      ) : null}
    </div>
  )
}
```

## Dependencies
- Task 008 (Custom hooks must be created)

## Conflicts
None

## Testing
```bash
# Test PrivacySettings component
npm run test -- PrivacySettings

# Test visibility toggles
npm run test -- VisibilityToggles

# Test data export
npm run test -- DataExportButton
```

## Verification
- [ ] VisibilityToggles render all fields
- [ ] Toggles update immediately
- [ ] DataExportButton triggers download
- [ ] Export includes all profile data
- [ ] Export includes timestamp
- [ ] Settings persist to database
- [ ] Loading states work
- [ ] Error handling implemented
- [ ] Private by default

## GDPR/CCPA Compliance
- Right to data portability (export)
- Right to privacy (private by default)
- Right to control (visibility toggles)
- Audit trail (timestamp)

## Privacy Features
- Profile visibility
- Email visibility
- Bio visibility
- Location visibility
- Social links visibility
- Data export (JSON)

## Notes
- Real-time updates on toggle
- Export format is JSON
- Include timestamp on export
- Default to private for all settings
- Document privacy implications
