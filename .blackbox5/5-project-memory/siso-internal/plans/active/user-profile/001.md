---
name: Validate Database Schema
status: open
created: 2026-01-18T08:24:04Z
parallel: false
effort: 2 hours
depends_on: []
conflicts_with: []
---

# Task: 001 - Validate Database Schema

## Specification
Validate and ensure the `profiles` table exists in Supabase with all required columns for the user profile feature. This task creates the foundation for all profile-related functionality.

## Acceptance Criteria
- [ ] `profiles` table exists in Supabase database
- [ ] All required columns are present: `id`, `name`, `bio`, `avatar_url`, `location`, `timezone`, `twitter_url`, `linkedin_url`, `youtube_url`, `instagram_url`, `sisos_tokens`, `created_at`, `updated_at`
- [ ] Column types match the specification (text, timestamp, etc.)
- [ ] Foreign key relationship to `auth.users` exists
- [ ] Table has proper indexes on `id` and `created_at`
- [ ] Missing columns created if needed
- [ ] Schema validation script passes

## Files
- `supabase/migrations/20260118000001_validate_profiles_table.sql` (new)
- `scripts/validate-profiles-schema.ts` (new)
- `.claude/epics/user-profile/001.md` (new)

## Technical Approach

### Step 1: Connect to Supabase
```bash
# Get Supabase connection details from environment
supabase status
```

### Step 2: Check Existing Schema
```sql
-- Check if profiles table exists
SELECT table_name, column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_name = 'profiles'
ORDER BY ordinal_position;
```

### Step 3: Create Migration if Missing
If columns are missing, create a migration:
```sql
-- Example: Add missing columns
ALTER TABLE profiles
ADD COLUMN IF NOT EXISTS bio TEXT,
ADD COLUMN IF NOT EXISTS avatar_url TEXT,
ADD COLUMN IF NOT EXISTS location TEXT,
ADD COLUMN IF NOT EXISTS timezone TEXT,
ADD COLUMN IF NOT EXISTS twitter_url TEXT,
ADD COLUMN IF NOT EXISTS linkedin_url TEXT,
ADD COLUMN IF NOT EXISTS youtube_url TEXT,
ADD COLUMN IF NOT EXISTS instagram_url TEXT,
ADD COLUMN IF NOT EXISTS sisos_tokens INTEGER DEFAULT 0;
```

### Step 4: Create Validation Script
Create a TypeScript script to validate schema programmatically:
```typescript
import { createClient } from '@supabase/supabase-js'

const supabase = createClient(
  process.env.VITE_SUPABASE_URL!,
  process.env.VITE_SUPABASE_ANON_KEY!
)

async function validateProfilesSchema() {
  const { data, error } = await supabase
    .rpc('validate_profiles_schema')

  if (error) {
    console.error('Schema validation failed:', error)
    return false
  }

  console.log('Schema validated successfully:', data)
  return true
}

validateProfilesSchema()
```

### Step 5: Run Validation
```bash
# Run validation script
npm run validate-profiles-schema
```

## Dependencies
None - This is the foundation task

## Conflicts
None

## Testing
```bash
# Test 1: Check table exists
psql $DATABASE_URL -c "\dt profiles"

# Test 2: Describe table structure
psql $DATABASE_URL -c "\d profiles"

# Test 3: Run validation script
npm run validate-profiles-schema

# Test 4: Test sample query
psql $DATABASE_URL -c "SELECT COUNT(*) FROM profiles;"
```

## Verification
- [ ] Table exists and is accessible
- [ ] All columns present with correct types
- [ ] Can query the table successfully
- [ ] Foreign key to auth.users works
- [ ] Indexes are created
- [ ] Validation script passes
- [ ] Migration file is committed

## Notes
- This must be completed before any other tasks
- If table doesn't exist, create it with proper schema
- Document any deviations from the epic specification
- Take note of any existing data that needs migration
