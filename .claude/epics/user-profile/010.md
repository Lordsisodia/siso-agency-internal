---
name: Build ProfileEdit Component
status: open
created: 2026-01-18T08:24:04Z
parallel: true
effort: 5 hours
depends_on: [008]
conflicts_with: []
---

# Task: 010 - Build ProfileEdit Component

## Specification
Create the ProfileEdit component with form validation using React Hook Form and Zod. This component allows users to edit their profile information with real-time validation.

## Acceptance Criteria
- [ ] `ProfileEdit` component created
- [ ] `BioField` component with character counter
- [ ] `LocationField` component
- [ ] `TimezoneSelector` component
- [ ] `SocialLinksEditor` component with URL validation
- [ ] React Hook Form integration
- [ ] Zod validation schemas
- [ ] Real-time validation feedback
- [ ] Dirty state tracking
- [ ] Cancel confirmation (if dirty)
- [ ] Auto-save draft to localStorage

## Files
- `src/domains/user/profile/2-edit/ui/components/BioField.tsx` (new)
- `src/domains/user/profile/2-edit/ui/components/LocationField.tsx` (new)
- `src/domains/user/profile/2-edit/ui/components/TimezoneSelector.tsx` (new)
- `src/domains/user/profile/2-edit/ui/components/SocialLinksEditor.tsx` (new)
- `src/domains/user/profile/2-edit/ui/components/ProfileEditForm.tsx` (new)
- `src/domains/user/profile/2-edit/ui/pages/ProfileEditPage.tsx` (new)
- `src/domains/user/profile/2-edit/index.ts` (new)

## Technical Approach

### Step 1: Create BioField Component
```typescript
// src/domains/user/profile/2-edit/ui/components/BioField.tsx
import { useFormContext } from 'react-hook-form'
import { Textarea } from '@/components/ui/textarea'
import { Label } from '@/components/ui/label'
import { FormField, FormItem, FormControl, FormMessage } from '@/components/ui/form'

const MAX_BIO_LENGTH = 500

export function BioField() {
  const { control, watch } = useFormContext()
  const bio = watch('bio') || ''

  return (
    <FormField
      control={control}
      name="bio"
      render={({ field }) => (
        <FormItem>
          <Label htmlFor="bio">Bio</Label>
          <FormControl>
            <Textarea
              id="bio"
              placeholder="Tell us about yourself..."
              className="min-h-32 resize-none"
              {...field}
            />
          </FormControl>
          <div className="flex justify-between items-center">
            <FormMessage />
            <span className={`text-xs ${
              bio.length > MAX_BIO_LENGTH * 0.9
                ? 'text-orange-600'
                : 'text-muted-foreground'
            }`}>
              {bio.length} / {MAX_BIO_LENGTH}
            </span>
          </div>
        </FormItem>
      )}
    />
  )
}
```

### Step 2: Create LocationField Component
```typescript
// src/domains/user/profile/2-edit/ui/components/LocationField.tsx
import { MapPin } from 'lucide-react'
import { useFormContext } from 'react-hook-form'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { FormField, FormItem, FormControl, FormMessage } from '@/components/ui/form'

export function LocationField() {
  const { control } = useFormContext()

  return (
    <FormField
      control={control}
      name="location"
      render={({ field }) => (
        <FormItem>
          <Label htmlFor="location">Location</Label>
          <FormControl>
            <div className="relative">
              <MapPin className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground" />
              <Input
                id="location"
                placeholder="San Francisco, CA"
                className="pl-10"
                {...field}
              />
            </div>
          </FormControl>
          <FormMessage />
        </FormItem>
      )}
    />
  )
}
```

### Step 3: Create TimezoneSelector Component
```typescript
// src/domains/user/profile/2-edit/ui/components/TimezoneSelector.tsx
import { Clock } from 'lucide-react'
import { useFormContext } from 'react-hook-form'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue
} from '@/components/ui/select'
import { Label } from '@/components/ui/label'
import { FormField, FormItem, FormControl, FormMessage } from '@/components/ui/form'

// Common timezones
const TIMEZONES = [
  'America/Los_Angeles',
  'America/New_York',
  'America/Chicago',
  'America/Denver',
  'Europe/London',
  'Europe/Paris',
  'Asia/Tokyo',
  'Asia/Shanghai',
  'Australia/Sydney',
  'UTC'
]

export function TimezoneSelector() {
  const { control } = useFormContext()

  return (
    <FormField
      control={control}
      name="timezone"
      render={({ field }) => (
        <FormItem>
          <Label htmlFor="timezone">Timezone</Label>
          <Select onValueChange={field.onChange} defaultValue={field.value}>
            <FormControl>
              <SelectTrigger>
                <Clock className="w-4 h-4 mr-2 text-muted-foreground" />
                <SelectValue placeholder="Select timezone" />
              </SelectTrigger>
            </FormControl>
            <SelectContent>
              {TIMEZONES.map((tz) => (
                <SelectItem key={tz} value={tz}>
                  {tz}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
          <FormMessage />
        </FormItem>
      )}
    />
  )
}
```

### Step 4: Create SocialLinksEditor Component
```typescript
// src/domains/user/profile/2-edit/ui/components/SocialLinksEditor.tsx
import { useFormContext } from 'react-hook-form'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { FormField, FormItem, FormControl, FormMessage } from '@/components/ui/form'
import { Twitter, Linkedin, Youtube, Instagram } from 'lucide-react'

interface SocialLinkField {
  name: string
  label: string
  icon: React.ComponentType<{ className?: string }>
  placeholder: string
}

const SOCIAL_LINKS: SocialLinkField[] = [
  {
    name: 'twitter_url',
    label: 'Twitter',
    icon: Twitter,
    placeholder: 'https://twitter.com/username'
  },
  {
    name: 'linkedin_url',
    label: 'LinkedIn',
    icon: Linkedin,
    placeholder: 'https://linkedin.com/in/username'
  },
  {
    name: 'youtube_url',
    label: 'YouTube',
    icon: Youtube,
    placeholder: 'https://youtube.com/@username'
  },
  {
    name: 'instagram_url',
    label: 'Instagram',
    icon: Instagram,
    placeholder: 'https://instagram.com/username'
  }
]

export function SocialLinksEditor() {
  const { control } = useFormContext()

  return (
    <div className="space-y-4">
      <h3 className="text-sm font-medium">Social Links</h3>

      {SOCIAL_LINKS.map((link) => {
        const Icon = link.icon
        return (
          <FormField
            key={link.name}
            control={control}
            name={link.name}
            render={({ field }) => (
              <FormItem>
                <Label htmlFor={link.name} className="flex items-center gap-2">
                  <Icon className="w-4 h-4" />
                  {link.label}
                </Label>
                <FormControl>
                  <Input
                    id={link.name}
                    placeholder={link.placeholder}
                    {...field}
                  />
                </FormControl>
                <FormMessage />
              </FormItem>
            )}
          />
        )
      })}
    </div>
  )
}
```

### Step 5: Create Main ProfileEdit Form
```typescript
// src/domains/user/profile/2-edit/ui/components/ProfileEditForm.tsx
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { useNavigate } from 'react-router-dom'
import { Button } from '@/components/ui/button'
import { useProfileUpdate } from '../../_shared/hooks'
import { profileUpdateSchema } from '../../_shared/types'
import type { Profile, ProfileUpdate } from '../../_shared/types'
import { BioField } from './BioField'
import { LocationField } from './LocationField'
import { TimezoneSelector } from './TimezoneSelector'
import { SocialLinksEditor } from './SocialLinksEditor'

interface ProfileEditFormProps {
  profile: Profile
  onCancel: () => void
}

export function ProfileEditForm({ profile, onCancel }: ProfileEditFormProps) {
  const navigate = useNavigate()
  const updateProfile = useProfileUpdate()

  const form = useForm<ProfileUpdate>({
    resolver: zodResolver(profileUpdateSchema),
    defaultValues: {
      name: profile.name || '',
      bio: profile.bio || '',
      location: profile.location || '',
      timezone: profile.timezone || '',
      twitter_url: profile.twitter_url || '',
      linkedin_url: profile.linkedin_url || '',
      youtube_url: profile.youtube_url || '',
      instagram_url: profile.instagram_url || ''
    }
  })

  const isDirty = form.formState.isDirty

  const handleSubmit = async (data: ProfileUpdate) => {
    try {
      await updateProfile.mutateAsync({
        userId: profile.id,
        updates: data
      })
      navigate('/profile')
    } catch (error) {
      console.error('Failed to update profile:', error)
    }
  }

  const handleCancel = () => {
    if (isDirty) {
      if (confirm('You have unsaved changes. Are you sure you want to cancel?')) {
        onCancel()
      }
    } else {
      onCancel()
    }
  }

  return (
    <form onSubmit={form.handleSubmit(handleSubmit)} className="space-y-6">
      <BioField />
      <LocationField />
      <TimezoneSelector />
      <SocialLinksEditor />

      <div className="flex gap-4 pt-4">
        <Button
          type="submit"
          disabled={!isDirty || updateProfile.isPending}
        >
          {updateProfile.isPending ? 'Saving...' : 'Save Changes'}
        </Button>
        <Button
          type="button"
          variant="outline"
          onClick={handleCancel}
        >
          Cancel
        </Button>
      </div>
    </form>
  )
}
```

### Step 6: Create Page Component
```typescript
// src/domains/user/profile/2-edit/ui/pages/ProfileEditPage.tsx
import { useNavigate } from 'react-router-dom'
import { useUserProfile } from '../../_shared/hooks'
import { ProfileEditForm } from '../components/ProfileEditForm'
import { useAuth } from '@/features/auth'

export function ProfileEditPage() {
  const navigate = useNavigate()
  const { data: { user } } = useAuth()
  const { data: profile, isLoading, error } = useUserProfile(user?.id)

  const handleCancel = () => {
    navigate('/profile')
  }

  if (isLoading) {
    return <div>Loading...</div>
  }

  if (error) {
    return <div>Error loading profile</div>
  }

  if (!profile) {
    return <div>No profile found</div>
  }

  return (
    <div className="container max-w-2xl py-8">
      <h1 className="text-3xl font-bold mb-6">Edit Profile</h1>
      <ProfileEditForm
        profile={profile}
        onCancel={handleCancel}
      />
    </div>
  )
}
```

## Dependencies
- Task 008 (Custom hooks must be created)

## Conflicts
None

## Testing
```bash
# Test ProfileEdit form
npm run test -- ProfileEditForm

# Test individual fields
npm run test -- BioField
npm run test -- SocialLinksEditor
```

## Verification
- [ ] BioField shows character counter
- [ ] LocationField validates input
- [ ] TimezoneSelector shows options
- [ ] SocialLinksEditor validates URLs
- [ ] Form validates with Zod
- [ ] Dirty state tracked correctly
- [ ] Cancel confirmation works
- [ ] Save button disabled when invalid
- [ ] Loading state during save
- [ ] Navigation after save

## Form Features
- Real-time validation
- Character counter (bio)
- URL validation (social links)
- Dirty state tracking
- Auto-save draft (localStorage)
- Cancel confirmation
- Optimistic updates

## Notes
- Use Zod for runtime validation
- Show helpful error messages
- Consider adding form autosave
- Test with long bio text
- Test with invalid URLs
