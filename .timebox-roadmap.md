# 📅 TIMEBOX ROADMAP - COHESIVE IMPLEMENTATION PLAN

## 🎯 DESIGN DECISIONS (LOCKED IN)

### Visual Design
- **Detail View**: Full-screen modal (not drawer)
- **Priority Indicator**: Border thickness/color
- **Category Colors**: Deep=Blue, Light=Green
- **Timer**: Lives in full-screen modal
- **Subtask Display**: Name on block + parent context available

### User Workflow
- Manual task placement (drag & drop)
- Click task → Full-screen detail view
- Timer start/stop in modal
- AI learns from 1 month of data before auto-suggesting

---

## 🚀 IMPLEMENTATION ROADMAP

### **PHASE 1: CORE UX FOUNDATION** (Week 1 - Days 1-3)
**Goal**: Perfect the basic interaction model

#### ✅ COMPLETED
- [x] Clean display (removed redundant time)
- [x] Supabase persistence (dual-layer storage)
- [x] Conflict detection (visual warnings)
- [x] Subtask count indicator
- [x] Duration badges

#### 🔨 IN PROGRESS (Days 1-3)
**1.1 Full-Screen Task Modal** (Day 1 - 4 hours)
```tsx
// Create: TaskDetailModal.tsx
Features:
- Full screen overlay
- Task name + parent context (if subtask)
- Subtask list (if parent)
- Priority badge
- Category indicator
- Notes section
- Action buttons: Reschedule, Adjust Duration, Complete
```

**Files to Create:**
- `src/ecosystem/internal/tasks/modals/TaskDetailModal.tsx`
- `src/ecosystem/internal/tasks/hooks/useTaskDetail.ts`

**1.2 Priority Border System** (Day 1 - 2 hours)
```tsx
// Update: EnhancedTimeBoxCalendar.tsx
Priority → Border Style:
- Critical: 4px solid red
- High: 3px solid orange
- Medium: 2px solid yellow
- Low: 1px solid gray
```

**1.3 Parent/Child Context Display** (Day 2 - 3 hours)
```tsx
// Logic:
if (task.parent_task_id) {
  // This IS a subtask
  display: "Subtask Name"
  context: "Part of: Parent Task"
} else if (task.subtasks?.length > 0) {
  // This IS a parent
  display: "Parent Task Name"
  badge: "📋 3/5 done"
}
```

**1.4 Drag-to-Reorder Polish** (Day 2 - 3 hours)
- Snap to time grid (15-min intervals)
- Ghost preview while dragging
- Auto-save new position
- Conflict warning if drop overlaps

**1.5 Time Picker Alternative** (Day 3 - 2 hours)
- Right-click → "Change Time" modal
- Quick picker with hour/minute select
- Alternative to drag-drop

---

### **PHASE 2: TIME TRACKING SYSTEM** (Week 1 - Days 4-7)
**Goal**: Track actual time spent, build training data

#### 🔨 TO BUILD (Days 4-7)

**2.1 Timer UI in Modal** (Day 4 - 4 hours)
```tsx
// In TaskDetailModal.tsx
<div className="timer-section">
  {isTimerActive ? (
    <>
      <div className="text-4xl font-bold">⏱️ 32:15</div>
      <Button onClick={pauseTimer}>⏸️ Pause</Button>
    </>
  ) : (
    <Button onClick={startTimer}>▶️ Start Timer</Button>
  )}

  <div className="comparison">
    Estimated: 1h | Actual: 32m so far
  </div>
</div>
```

**2.2 Timer Backend Logic** (Day 5 - 4 hours)
```tsx
// Create: useTaskTimer.ts
Features:
- Start/pause/stop timer
- Persist timer state (survive refresh)
- Auto-save time logs to Supabase
- Track interruptions
```

**2.3 Supabase Schema for Time Logs** (Day 5 - 1 hour)
```sql
CREATE TABLE task_time_logs (
  id UUID PRIMARY KEY,
  user_id UUID,
  task_id UUID,
  started_at TIMESTAMP,
  paused_at TIMESTAMP,
  total_seconds INTEGER,
  interruption_count INTEGER,
  date DATE
);
```

**2.4 Actual vs Estimated Display** (Day 6 - 2 hours)
- Show variance in task detail
- Color code: Green=under, Red=over, Yellow=close
- Store for AI learning

**2.5 Active Timer Indicator** (Day 7 - 2 hours)
```tsx
// Sticky header when timer running:
┌────────────────────────────────────────┐
│ 🔴 ACTIVE: Write Proposal  |  ⏱️ 32m  │
└────────────────────────────────────────┘
```

---

### **PHASE 3: SUBTASK MANAGEMENT** (Week 2 - Days 8-10)
**Goal**: Perfect subtask visibility and interaction

#### 🔨 TO BUILD (Days 8-10)

**3.1 Enhanced Subtask List** (Day 8 - 4 hours)
```tsx
// In TaskDetailModal.tsx
<div className="subtask-section">
  {subtasks.map(subtask => (
    <div className="subtask-item">
      <Checkbox checked={subtask.completed} />
      <span>{subtask.title}</span>
      <Badge>30m</Badge>
      {subtask.isScheduled && <Badge>📅 On timeline</Badge>}
      <Button>▶️ Start</Button> // Timer per subtask
    </div>
  ))}
</div>
```

**3.2 Subtask → Parent Navigation** (Day 9 - 2 hours)
- If viewing subtask → "View Parent Task" button
- If viewing parent → quick jump to scheduled subtasks

**3.3 Schedule Individual Subtasks** (Day 9 - 3 hours)
- From parent task modal → "Schedule This Subtask" button
- Drag subtask from modal to timeline
- Creates timeblock for that specific subtask

**3.4 Progress Calculation** (Day 10 - 2 hours)
- Real-time progress: "3/5 subtasks done"
- Time progress: "2h of 5h estimated completed"
- Visual progress ring on parent tasks

---

### **PHASE 4: AI INTELLIGENCE (SILENT)** (Week 2-3 - Background)
**Goal**: Collect data, no user-facing features yet

#### 🧠 DATA COLLECTION (Days 8-21)

**4.1 Event Logging** (Day 11 - 3 hours)
```sql
CREATE TABLE task_analytics (
  user_id UUID,
  task_id UUID,
  scheduled_time TIME,
  actual_start_time TIME,
  actual_end_time TIME,
  completed BOOLEAN,
  rescheduled_count INTEGER,
  date DATE
);
```

**4.2 Pattern Detection (Silent)** (Days 12-21)
- Track what times you schedule deep work
- Track completion rates by time of day
- Track typical task durations
- Track reschedule patterns
- Store in analytics table (no UI yet)

---

### **PHASE 5: POLISH & QUALITY OF LIFE** (Week 3 - Days 14-17)
**Goal**: Make it feel premium

#### 🔨 TO BUILD (Days 14-17)

**5.1 Smooth Animations** (Day 14 - 3 hours)
- Block placement animations
- Modal slide transitions
- Timer pulse effect
- Completion celebrations

**5.2 Keyboard Shortcuts** (Day 15 - 2 hours)
```
ESC: Close modal
SPACE: Start/pause timer
↑/↓: Navigate blocks
ENTER: Open detail
```

**5.3 Mobile Gestures** (Day 16 - 4 hours)
- Swipe right: Complete task
- Swipe left: Reschedule options
- Long press: Quick actions menu
- Pinch: Zoom timeline (compact/expanded view)

**5.4 Quick Actions Menu** (Day 17 - 3 hours)
- Right-click on block → context menu
- Duplicate, Delete, Move to Tomorrow, etc.
- Quick duration presets (+15m, +30m, +1h)

---

### **PHASE 6: AI AUTO-SUGGESTIONS** (Month 2 - After 30 Days Data)
**Goal**: AI becomes useful assistant

#### 🤖 FEATURES (Days 30+)

**6.1 Smart Time Suggestions** (Week 5)
```tsx
// When dragging task:
"🤖 AI suggests: 9:00 AM (you're 80% more productive then)"
"⚡ High energy window available: 2:00 PM"
```

**6.2 Break Optimization** (Week 5)
- Auto-detect long work blocks
- Suggest break placement
- "You usually need a break after 90min of deep work"

**6.3 Duration Predictions** (Week 6)
- "Similar tasks took you 1.5h on average"
- Auto-fill estimated duration
- Warn if schedule too packed

**6.4 Pattern Templates** (Week 6)
- "Your typical Monday looks like this"
- Save detected patterns as templates
- One-click schedule replication

---

## 📅 TIMELINE SUMMARY

### **Week 1** (Days 1-7)
- ✅ Core persistence & conflict detection (DONE)
- 🔨 Full-screen modal (3 days)
- 🔨 Time tracking system (4 days)

### **Week 2** (Days 8-14)
- 🔨 Subtask management (3 days)
- 🧠 Silent data collection starts (background)
- 🔨 Start on polish features (2 days)

### **Week 3** (Days 15-21)
- 🔨 Complete polish & QoL features
- 🧠 Data collection continues
- 🧪 User testing & feedback

### **Month 2** (Day 30+)
- 🤖 AI suggestions activated
- 📊 Pattern recognition
- 🎯 Template system

---

## 🔧 TECHNICAL IMPLEMENTATION NOTES

### Database Schema Additions Needed

**1. task_time_logs** (Phase 2)
```sql
CREATE TABLE task_time_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL,
  task_id UUID NOT NULL,
  timeblock_id UUID REFERENCES day_schedules(id),
  started_at TIMESTAMPTZ NOT NULL,
  paused_at TIMESTAMPTZ,
  stopped_at TIMESTAMPTZ,
  total_seconds INTEGER DEFAULT 0,
  interruption_count INTEGER DEFAULT 0,
  date DATE NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

**2. task_analytics** (Phase 4)
```sql
CREATE TABLE task_analytics (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL,
  task_id UUID NOT NULL,
  scheduled_time TIME,
  actual_start_time TIME,
  actual_end_time TIME,
  duration_minutes INTEGER,
  completed BOOLEAN,
  rescheduled_count INTEGER DEFAULT 0,
  energy_level VARCHAR(20),
  date DATE NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### Component Structure

**New Components to Create:**
1. `TaskDetailModal.tsx` - Full-screen task detail
2. `TaskTimer.tsx` - Timer UI component
3. `SubtaskList.tsx` - Clean subtask display
4. `TimePickerModal.tsx` - Alternative to drag-drop
5. `QuickActionsMenu.tsx` - Right-click context menu

**Hooks to Create:**
1. `useTaskTimer.ts` - Timer state management
2. `useTaskDetail.ts` - Task detail fetching
3. `useTimeblockDrag.ts` - Drag-drop logic
4. `useTaskAnalytics.ts` - Analytics collection

---

## 📊 SUCCESS METRICS

### Week 1 Goals
- [ ] Can reschedule tasks via drag-drop (< 2 seconds)
- [ ] Data persists across refreshes (100% reliability)
- [ ] No overlapping blocks (auto-detect + fix)
- [ ] Task detail modal loads < 200ms

### Week 2 Goals
- [ ] Timer tracks actual time spent
- [ ] Subtask progress visible in detail view
- [ ] Can complete subtasks individually
- [ ] Time data logged for AI training

### Month 1 Goals
- [ ] 30 days of usage data collected
- [ ] Completion patterns identified
- [ ] Average task durations calculated
- [ ] Ready for AI suggestions

---

## 🎯 IMMEDIATE NEXT STEPS (Today)

### **Build Order:**

**Step 1: Task Detail Modal** (Start Now)
1. Create modal component structure
2. Fetch task details + parent/child relationships
3. Display subtasks cleanly
4. Add timer UI (non-functional placeholder)

**Step 2: Priority Border System** (After modal)
1. Map priority → border styles
2. Update calendar component
3. Test visual clarity

**Step 3: Timer Backend** (After UI complete)
1. Create `useTaskTimer` hook
2. Add timer state to Supabase
3. Connect to modal UI
4. Test persistence

**Step 4: Drag-to-Reorder** (Final polish)
1. Add snap-to-grid
2. Ghost preview
3. Auto-save position
4. Conflict warning

---

## 🛠️ TECHNICAL STACK

### Dependencies (Already Have)
- ✅ Framer Motion (animations)
- ✅ React Hook Form (forms)
- ✅ Supabase (database)
- ✅ Radix UI (modals/tooltips)
- ✅ date-fns (time utils)

### No New Dependencies Needed!

---

## 📝 COMPONENT ARCHITECTURE

### File Structure
```
src/ecosystem/internal/tasks/
├── modals/
│   ├── TaskDetailModal.tsx       [NEW]
│   └── TimePickerModal.tsx       [NEW]
├── components/
│   ├── TaskTimer.tsx              [NEW]
│   ├── SubtaskList.tsx            [NEW]
│   └── PriorityBorder.tsx         [NEW]
├── hooks/
│   ├── useTaskTimer.ts            [NEW]
│   ├── useTaskDetail.ts           [NEW]
│   └── useTimeblockDrag.ts        [NEW]
└── ui/
    └── EnhancedTimeBoxCalendar.tsx [UPDATE]
```

---

## 🎨 DESIGN MOCKUP

### Timebox Calendar View
```
┌─────────────────────────────────────────┐
│                 3 PM                    │
├─────────────────────────────────────────┤
│ ⚠️ Conflicts detected  [🔧 Auto-Fix]   │
├─────────────────────────────────────────┤
│ 4 PM                                    │
├─────────────────────────────────────────┤
│ ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓  │ ← Thick red border (high priority)
│ ┃ 🧠 Write Proposal  📋 3  |  1h 30m ┃  │
│ ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  │
│                                         │
│ ┌───────────────────────────────────┐  │ ← Normal border (low priority)
│ │ 🟢 Email Admin      30m            │  │
│ └───────────────────────────────────┘  │
│                                         │
│ 5 PM                                    │
└─────────────────────────────────────────┘
```

### Task Detail Modal (Full Screen)
```
┌──────────────────────────────────────────────────────┐
│  ← Back                                         ✕    │
├──────────────────────────────────────────────────────┤
│                                                      │
│     🧠 Write Proposal                                │
│     Part of: Client Project Q4                       │
│     Priority: High  |  Deep Work  |  Scheduled: 4PM │
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │          ⏱️ TIMER: 32:15                       │ │
│  │     [⏸️ Pause]        [⏹️ Stop & Log]         │ │
│  │  Estimated: 1h 30m  |  Actual: 32m so far     │ │
│  └────────────────────────────────────────────────┘ │
│                                                      │
│  ━━━ Subtasks (3/5 Complete) ━━━━━━━━━━━━━━━━━━━━  │
│                                                      │
│  ✅ Research competitors         [⏱️ 25m actual]    │
│  ✅ Outline structure             [⏱️ 15m actual]    │
│  ▶️ Write draft                   [▶️ Start]         │
│  ⭘ Client review                  [Not started]     │
│  ⭘ Final revisions                [Not started]     │
│                                                      │
│  ━━━ Notes ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│  [Notes content here if any...]                     │
│                                                      │
│  ━━━ Actions ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│  [🕐 Reschedule]  [⏱️ Adjust Duration]  [✓ Complete]│
│                                                      │
└──────────────────────────────────────────────────────┘
```

---

## 🎯 IMPLEMENTATION PRIORITIES

### Must Have (Week 1)
1. Full-screen modal
2. Priority borders
3. Basic timer (start/stop)
4. Drag-to-reorder

### Should Have (Week 2)
1. Timer persistence
2. Time logging to DB
3. Subtask timer tracking
4. Actual vs estimated display

### Nice to Have (Week 3+)
1. Keyboard shortcuts
2. Mobile gestures
3. Quick actions menu
4. AI suggestions (after 30 days)

---

## 📈 DATA COLLECTION STRATEGY

### Training Data for AI (Passive)

**Collecting from Day 1:**
- Task scheduled time vs actual start time
- Actual duration vs estimated
- Completion rate by time of day
- Reschedule frequency
- Energy level correlation

**After 30 Days:**
- Identify user's peak focus hours
- Predict realistic task durations
- Suggest optimal scheduling times
- Auto-insert breaks intelligently

---

## 🚦 ROLLOUT PLAN

### **Sprint 1** (Days 1-7)
**Deliverable**: Full-screen modal + timer + priority borders

**Testing Checklist:**
- [ ] Can open task detail modal
- [ ] Timer starts/pauses correctly
- [ ] Priority borders display correctly
- [ ] Subtasks show in modal
- [ ] Can reschedule via drag-drop
- [ ] Data persists on refresh (Supabase + localStorage)

### **Sprint 2** (Days 8-14)
**Deliverable**: Time tracking + subtask management

**Testing Checklist:**
- [ ] Timer data saves to Supabase
- [ ] Can track individual subtask time
- [ ] Actual vs estimated comparison shown
- [ ] Subtask progress updates parent task
- [ ] Can schedule individual subtasks

### **Sprint 3** (Days 15-21)
**Deliverable**: Polish + analytics collection

**Testing Checklist:**
- [ ] Smooth animations
- [ ] Mobile gestures work
- [ ] Keyboard shortcuts active
- [ ] 30 days of analytics collected
- [ ] No performance issues

### **Sprint 4** (Day 30+)
**Deliverable**: AI-powered suggestions

**Testing Checklist:**
- [ ] AI suggests optimal times
- [ ] Break suggestions appear
- [ ] Duration predictions accurate
- [ ] Template detection working

---

## ⚡ SIMPLIFIED COLOR SYSTEM

### Category Colors (Keep Simple)
- **🔵 Deep Work**: Blue gradient
- **🟢 Light Work**: Green gradient
- **⚪ Other**: Gray (health, breaks, admin, etc.)

### Priority Colors (Border)
- **Critical**: Red (4px solid)
- **High**: Orange (3px solid)
- **Medium**: Yellow (2px solid)
- **Low**: Gray (1px solid)

---

## 🎬 START TODAY - BUILD ORDER

### **Today (3-4 hours of work):**

1. **Task Detail Modal** (2 hours)
   - Basic structure
   - Task info display
   - Subtask list
   - Close/back functionality

2. **Priority Borders** (30 min)
   - Map priority to border style
   - Update calendar component

3. **Timer UI Placeholder** (1 hour)
   - Timer display in modal
   - Start/pause buttons (non-functional)
   - Layout and design

4. **Test Everything** (30 min)
   - Click task → modal opens
   - Priority borders visible
   - Subtasks display correctly

---

## ✅ READY TO BUILD?

**I'll start with:**
1. TaskDetailModal.tsx (full-screen)
2. Priority border system
3. Hook up task click → modal

**Estimated Time**: 2-3 hours for working prototype

**Should I proceed with building the modal?** 🚀
